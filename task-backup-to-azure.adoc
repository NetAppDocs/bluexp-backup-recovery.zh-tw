---
sidebar: sidebar 
permalink: task-backup-to-azure.html 
keywords: backing up, back up, backup, backup cloud volumes ontap, back up cloud volumes ontap, cloud volumes ontap, azure, azure blob, back up volumes, cloud backup 
summary: 請完成幾個步驟、開始將 Cloud Volumes ONTAP 系統的大量資料備份至 Azure Blob 儲存設備。 
---
= 將Cloud Volumes ONTAP 不支援的資料備份到Azure Blob儲存設備
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
請完成幾個步驟、開始將 Cloud Volumes ONTAP 系統的大量資料備份至 Azure Blob 儲存設備。



== 快速入門

請依照下列步驟快速入門、或向下捲動至其餘部分以取得完整詳細資料。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["一"] 確認您的組態支援
[role="quick-margin-list"]
* 您在Cloud Volumes ONTAP Azure中執行的是版本號為1.7P5或更新版本ONTAP （建議使用版本號為0、8P13及更新版本）。
* 您已訂閱有效的雲端供應商、以取得備份所在的儲存空間。
* 您已訂閱 https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.cloud-manager?tab=Overview["BlueXP Marketplace備份產品"^]或您已購買 link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license["並啟動"^] NetApp 的 BlueXP 備份與恢復 BYOL 授權。
* 您在Azure中安裝了Connector。Connector 可安裝在具有完整網際網路存取（「標準模式」）的站台、或是有限的網際網路連線（「受限模式」）。


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["二"] 在您的新系統或現有系統上啟用 BlueXP 備份與還原
[role="quick-margin-list"]
* 新系統：在工作環境精靈中、預設會啟用 BlueXP 備份與還原。請務必保持啟用選項。
* 現有系統：選取工作環境、然後按一下右窗格中備份與還原服務旁的*啟用*、然後依照設定精靈進行。
+
image:screenshot_backup_cvo_enable.png["螢幕擷取畫面顯示 BlueXP 備份與還原啟用按鈕、可在您選取工作環境之後使用。"]



.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["三"] 輸入供應商詳細資料
[role="quick-margin-para"]
選取提供者訂閱和地區、然後選擇是要建立新的資源群組、還是要使用現有的資源群組。您也可以選擇自己的客戶管理金鑰來進行資料加密、而非使用預設的Microsoft管理加密金鑰。

[role="quick-margin-para"]
image:screenshot_backup_provider_settings_azure.png["快照顯示雲端供應商將磁碟區從Cloud Volumes ONTAP 某個系統備份到Azure Blob層時的詳細資料。"]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-4.png["四"] 定義預設備份原則
[role="quick-margin-para"]
預設原則會每天備份磁碟區、並保留每個磁碟區最近 30 個備份複本。變更為每小時、每日、每週、每月或每年備份、 或選取其中一個系統定義的原則、以提供更多選項。您也可以變更要保留的備份複本數量。

[role="quick-margin-para"]
您也可以選擇在使用ONTAP 更新版本的時、設定_DataLock和勒索軟體Protection _設定、保護備份免受刪除和勒索軟體攻擊。 link:concept-cloud-backup-policies.html["深入瞭解可用的 BlueXP 備份與還原原則組態設定"^]。

[role="quick-margin-para"]
根據預設、備份會儲存在Cool存取層中。如果您的叢集使用ONTAP 的是更新版本的版本、您可以選擇在特定天數後將備份分層至Azure歸檔儲存設備、以進一步最佳化成本。 link:concept-cloud-backup-policies.html["深入瞭解可用的 BlueXP 備份與還原原則組態設定"^]。

[role="quick-margin-para"]
image:screenshot_backup_policy_azure.png["顯示 BlueXP 備份與還原設定的螢幕擷取畫面、您可以在其中選取備份原則並選擇備份保留。"]

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-5.png["五"] 選取您要備份的磁碟區
[role="quick-margin-para"]
在「Select Volumes（選取磁碟區）」頁面中、使用預設的備份原則來識別要備份的磁碟區。如果您想要將不同的備份原則指派給特定磁碟區、可以建立其他原則、並於稍後套用至磁碟區。



== 需求

請先閱讀下列需求、確定您擁有支援的組態、再開始將磁碟區備份至 Azure Blob 儲存設備。

下圖顯示每個元件及其之間需要準備的連線：

image:diagram_cloud_backup_cvo_azure.png["顯示 BlueXP 備份與還原如何與來源系統上的磁碟區和備份檔案所在的目的地儲存設備進行通訊的圖表。"]

支援 ONTAP 的支援版本:: 最低ONTAP 版本為0、9、75；ONTAP 建議使用0、8P13及更新版本。
授權需求:: 若為 BlueXP 備份與還原 PAYGO 授權、您必須先透過 Azure Marketplace 訂閱、才能啟用 BlueXP 備份與還原。BlueXP 備份與還原的帳單是透過此訂閱完成。 https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-deploying-otc-azure.html["您可以從工作環境精靈的詳細資料  認證頁面訂閱"^]。
+
--
對於 BlueXP 備份與恢復 BYOL 授權、您需要 NetApp 的序號、以便在授權期間和容量內使用該服務。 link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license["瞭解如何管理BYOL授權"]。當 Connector 和 Cloud Volumes ONTAP 系統部署在黑暗的站台（「私有模式」）時、您必須使用 BYOL 授權。

而且您必須訂閱 Microsoft Azure 、才能取得備份所在的儲存空間。

--
連接器需求:: Connector 可安裝在 Azure 區域、且可存取完整或有限的網際網路（「標準」或「受限」模式）。 https://docs.netapp.com/us-en/bluexp-setup-admin/concept-modes.html["如需詳細資訊、請參閱 BlueXP 部署模式"^]。
+
--
* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html["深入瞭解連接器"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-connector-azure.html["以標準模式在 Azure 中部署 Connector （完整網際網路存取）"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-restricted-mode.html["以受限模式安裝 Connector （有限的輸出存取）"^]


--


驗證或新增連接器權限:: 若要使用 BlueXP 備份與還原搜尋與還原功能、您必須擁有 Connector 角色的特定權限、才能存取 Azure Synapse Workspace 和 Data Lake Storage 帳戶。請參閱下列權限、如果您需要修改原則、請遵循這些步驟。
+
--
.開始之前
* 您必須在訂閱中註冊Azure Synapse Analytics資源供應商（稱為「Microsoft.Synapse」）。 https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-providers-and-types#register-resource-provider["請參閱如何註冊此資源供應商以取得您的訂閱"^]。您必須是訂閱*擁有者*或*貢獻者*才能登錄資源提供者。
* 連接埠1433必須開啟、以便連接器與Azure Synapse SQL服務之間進行通訊。
+
.步驟
.. 識別指派給Connector虛擬機器的角色：
+
... 在Azure入口網站中、開啟虛擬機器服務。
... 選取 Connector 虛擬機器。
... 在「設定」下、選取「*身分識別*」。
... 按一下* Azure角色指派*。
... 記下指派給Connector虛擬機器的自訂角色。


.. 更新自訂角色：
+
... 在Azure入口網站中、開啟您的Azure訂閱。
... 按一下*存取控制（IAM）>角色*。
... 按一下自訂角色的省略符號（...）、然後按一下*編輯*。
... 按一下Json並新增下列權限：
+
[source, json]
----
"Microsoft.Compute/virtualMachines/read",
"Microsoft.Compute/virtualMachines/start/action",
"Microsoft.Compute/virtualMachines/deallocate/action",
"Microsoft.Storage/storageAccounts/listkeys/action",
"Microsoft.Storage/storageAccounts/read",
"Microsoft.Storage/storageAccounts/write",
"Microsoft.Storage/storageAccounts/blobServices/containers/read",
"Microsoft.Storage/storageAccounts/listAccountSas/action",
"Microsoft.KeyVault/vaults/read",
"Microsoft.KeyVault/vaults/accessPolicies/write",
"Microsoft.Network/networkInterfaces/read",
"Microsoft.Resources/subscriptions/locations/read",
"Microsoft.Network/virtualNetworks/read",
"Microsoft.Network/virtualNetworks/subnets/read",
"Microsoft.Resources/subscriptions/resourceGroups/read",
"Microsoft.Resources/subscriptions/resourcegroups/resources/read",
"Microsoft.Resources/subscriptions/resourceGroups/write",
"Microsoft.Authorization/locks/*",
"Microsoft.Network/privateEndpoints/write",
"Microsoft.Network/privateEndpoints/read",
"Microsoft.Network/privateDnsZones/virtualNetworkLinks/write",
"Microsoft.Network/virtualNetworks/join/action",
"Microsoft.Network/privateDnsZones/A/write",
"Microsoft.Network/privateDnsZones/read",
"Microsoft.Network/privateDnsZones/virtualNetworkLinks/read",
"Microsoft.Compute/virtualMachines/extensions/delete",
"Microsoft.Compute/virtualMachines/delete",
"Microsoft.Network/networkInterfaces/delete",
"Microsoft.Network/networkSecurityGroups/delete",
"Microsoft.Resources/deployments/delete",
"Microsoft.ManagedIdentity/userAssignedIdentities/assign/action",
"Microsoft.Synapse/workspaces/write",
"Microsoft.Synapse/workspaces/read",
"Microsoft.Synapse/workspaces/delete",
"Microsoft.Synapse/register/action",
"Microsoft.Synapse/checkNameAvailability/action",
"Microsoft.Synapse/workspaces/operationStatuses/read",
"Microsoft.Synapse/workspaces/firewallRules/read",
"Microsoft.Synapse/workspaces/replaceAllIpFirewallRules/action",
"Microsoft.Synapse/workspaces/operationResults/read",
"Microsoft.Synapse/workspaces/privateEndpointConnectionsApproval/action"
----
+
https://docs.netapp.com/us-en/bluexp-setup-admin/reference-permissions-azure.html["檢視原則的完整Json格式"^]

... 按一下「*檢閱+更新*」、然後按一下「*更新*」。






--
支援的 Azure 地區:: 所有 Azure 區域均支援 BlueXP 備份與還原 https://cloud.netapp.com/cloud-volumes-global-regions["支援的地方 Cloud Volumes ONTAP"^]（包括Azure政府區域）。
+
--
根據預設、 BlueXP 備份與還原會以本機備援（ LRS ）來配置 Blob 容器、以達到成本最佳化。如果您想要確保在不同區域之間複寫資料、您可以在 BlueXP 備份與還原啟動之後、將此設定變更為區域備援（ ZRS ）。請參閱的 Microsoft 指示 https://learn.microsoft.com/en-us/azure/storage/common/redundancy-migration?tabs=portal["變更儲存帳戶的複寫方式"^]。

--
在不同Azure訂閱中建立備份所需的設定:: 根據預設、備份會使用與Cloud Volumes ONTAP 您的作業系統相同的訂閱方式建立。如果您想要使用不同的Azure訂閱來進行備份、您必須使用 link:reference-backup-multi-account-azure.html["登入Azure入口網站並連結這兩份訂閱"]。
使用客戶管理金鑰進行資料加密的必要資訊:: 您可以在啟動精靈中使用自己的客戶管理金鑰進行資料加密、而非使用預設的Microsoft管理加密金鑰。在此情況下、您必須擁有Azure訂閱、Key Vault名稱及金鑰。 https://docs.microsoft.com/en-us/azure/storage/common/customer-managed-keys-overview["瞭解如何使用您自己的金鑰"^]。
+
--
請注意、備份與還原支援 _Azure 存取原則 _ 做為權限模型。目前不支援 _Azure 角色型存取控制 _ （ Azure RBAC ）權限模式。

--




== 在新系統上啟用 BlueXP 備份與還原

在工作環境精靈中、預設會啟用 BlueXP 備份與還原。請務必保持啟用選項。

請參閱 https://docs.netapp.com/us-en/bluexp-cloud-volumes-ontap/task-deploying-otc-azure.html["在 Cloud Volumes ONTAP Azure 中啟動"^] 以瞭解建立 Cloud Volumes ONTAP 您的整個系統的需求與詳細資料。


NOTE: 如果您想要選擇資源群組的名稱、請在部署 Cloud Volumes ONTAP 時 * 停用 * BlueXP 備份與還原。請依照的步驟執行 <<enabling-bluexp-backup-and-recovery-on-an-existing-system,在現有系統上啟用 BlueXP 備份與還原>> 若要啟用 BlueXP 備份與還原、請選擇資源群組。

.步驟
. 按一下「 * 建立 Cloud Volumes ONTAP 參考 * 」。
. 選擇 Microsoft Azure 作為雲端供應商、然後選擇單一節點或 HA 系統。
. 在「定義Azure認證」頁面中、輸入認證名稱、用戶端ID、用戶端機密和目錄ID、然後按一下*繼續*。
. 請填寫「詳細資料與認證」頁面、並確定Azure Marketplace訂閱已就緒、然後按一下*繼續*。
. 在「服務」頁面上、讓服務保持啟用狀態、然後按一下 * 繼續 * 。
+
image:screenshot_backup_to_gcp.png["顯示工作環境精靈中的 BlueXP 備份與還原選項。"]

. 完成精靈中的頁面以部署系統。


.結果
系統上啟用 BlueXP 備份與還原功能、並每天備份磁碟區、並保留最近 30 份備份複本。



== 在現有系統上啟用 BlueXP 備份與還原

隨時直接從工作環境啟用 BlueXP 備份與還原。

.步驟
. 選取工作環境、然後按一下右窗格中備份與還原服務旁的*啟用*。
+
如果您的備份Azure Blob目的地是以工作環境形式存在於Canvas上、您可以將叢集拖曳至Azure Blob工作環境、以啟動設定精靈。

+
image:screenshot_backup_cvo_enable.png["螢幕擷取畫面顯示 BlueXP 備份與還原啟用按鈕、可在您選取工作環境之後使用。"]

. 選取供應商詳細資料、然後按*下一步*。
+
.. Azure 訂閱用於儲存備份。這可能是與Cloud Volumes ONTAP 駐留於此系統不同的訂閱方式。
+
如果您想要使用不同的Azure訂閱來進行備份、您必須使用 link:reference-backup-multi-account-azure.html["登入Azure入口網站並連結這兩份訂閱"]。

.. 儲存備份的區域。這可能與Cloud Volumes ONTAP 駐留的地方不同。
.. 管理Blob容器的資源群組-您可以建立新的資源群組或選取現有的資源群組。
.. 無論您是使用預設的Microsoft管理加密金鑰、還是選擇自己的客戶管理金鑰來管理資料加密。 (https://docs.microsoft.com/en-us/azure/storage/common/customer-managed-keys-overview["瞭解如何使用您自己的金鑰"]）。
+
image:screenshot_backup_provider_settings_azure.png["快照顯示雲端供應商將磁碟區從Cloud Volumes ONTAP 某個系統備份到Azure Blob層時的詳細資料。"]



. 輸入將用於預設原則的備份原則詳細資料、然後按一下「*下一步*」。您可以選取現有的原則、也可以在每個區段中輸入您的選擇來建立新原則：
+
.. 輸入預設原則的名稱。您不需要變更名稱。
.. 定義備份排程、並選擇要保留的備份數量。 link:concept-ontap-backup-to-cloud.html#customizable-backup-schedule-and-retention-settings["請參閱您可以選擇的現有原則清單"^]。
.. 您也可以選擇在使用ONTAP 更新版本的時、設定_DataLock和勒索軟體Protection _設定、保護備份免受刪除和勒索軟體攻擊。_DataLock_可保護您的備份檔案、避免遭到修改或刪除、而_勒索 軟體保護_會掃描您的備份檔案、尋找備份檔案中勒索軟體攻擊的證據。 link:concept-cloud-backup-policies.html#datalock-and-ransomware-protection["深入瞭解可用的DataLock設定"^]。
.. 若使用ONTAP 的是更新版本的版本、您可以選擇在特定天數後將備份分層至Azure歸檔儲存設備、以進一步最佳化成本。當部署於黑暗站台時、此功能無法使用。 link:reference-azure-backup-tiers.html["深入瞭解如何使用歸檔層"]。
+
image:screenshot_backup_policy_azure.png["顯示 BlueXP 備份與還原設定的螢幕擷取畫面、可供您選擇排程與備份保留。"]



. 在「Select Volumes（選取磁碟區）」頁面中、使用定義的備份原則選取您要備份的磁碟區。如果您想要將不同的備份原則指派給特定磁碟區、可以建立其他原則、並於稍後將其套用至這些磁碟區。
+
** 若要備份未來新增的所有現有磁碟區和任何磁碟區、請勾選「備份所有現有和未來的磁碟區...」方塊。我們建議您使用此選項、以便備份所有的磁碟區、而且您永遠不需要記住為新的磁碟區啟用備份。
** 若要僅備份現有磁碟區、請勾選標題列中的方塊（image:button_backup_all_volumes.png[""]）。
** 若要備份個別磁碟區、請勾選每個磁碟區的方塊（image:button_backup_1_volume.png[""]）。
+
image:screenshot_backup_select_volumes.png["選取要備份之磁碟區的快照。"]

** 如果此工作環境中有任何讀寫磁碟區的本機Snapshot複本符合您剛才為此工作環境所選取的備份排程標籤（例如每日、每週等）、則會顯示另一個提示：「Export existing Snapshot copies to object storage as Backup copies（匯出現有的Snapshot複本至物件儲存區做為備份複本）」。如果您想要將所有歷史Snapshot複製到物件儲存設備做為備份檔案、以確保為磁碟區提供最完整的保護、請勾選此方塊。


. 按一下 * 啟動備份 * 、然後 BlueXP 備份與還原會開始為每個選取的磁碟區進行初始備份。


.結果
Blob儲存容器會自動建立在您輸入的資源群組中、並儲存備份檔案。

Volume Backup Dashboard隨即顯示、以便您監控備份狀態。您也可以使用監控備份與還原工作的狀態 link:task-monitor-backup-jobs.html["「工作監控」面板"^]。

根據預設、 BlueXP 備份與還原會以本機備援（ LRS ）來配置 Blob 容器、以達到成本最佳化。如果您想要確保資料在不同區域之間複寫、可以將此設定變更為區域備援（ ZRS ）。請參閱的 Microsoft 指示 https://learn.microsoft.com/en-us/azure/storage/common/redundancy-migration?tabs=portal["變更儲存帳戶的複寫方式"^]。



== 接下來呢？

* 您可以 link:task-manage-backups-ontap.html["管理備份檔案與備份原則"^]。這包括開始和停止備份、刪除備份、新增和變更備份排程等。
* 您可以 link:task-manage-backup-settings-ontap.html["管理叢集層級的備份設定"^]。這包括變更可上傳備份至物件儲存設備的網路頻寬、變更未來磁碟區的自動備份設定等。
* 您也可以 link:task-restore-backups-ontap.html["從備份檔案還原磁碟區、資料夾或個別檔案"^] 至Cloud Volumes ONTAP Azure的某個系統、或內部部署ONTAP 的系統。

